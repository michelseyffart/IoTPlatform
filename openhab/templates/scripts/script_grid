var dem = parseInt(items.getItem("demand_BUILDING_ID").state);
var sur = parseInt(items.getItem("surplus_BUILDING_ID").state);
var n_opt = parseInt(items.getItem("n_opt_BUILDING_ID").state);

var trans_quant = parseFloat(items.getItem("trans_quant_BUILDING_ID").state);
var trans_buying = items.getItem("trans_buying_BUILDING_ID").state;

var from_grid = trans_buying == "true" ? dem - trans_quant : dem;
var to_grid = trans_buying == "false" ? sur - trans_quant : sur;

items.getItem("from_grid_BUILDING_ID").postUpdate(from_grid);
items.getItem("to_grid_BUILDING_ID").postUpdate(to_grid);

payload = {
  "n_opt": n_opt,
  "from_grid": from_grid,
  "to_grid": to_grid
}

actions.thingActions("mqtt", "BRIDGE_UID").publishMQTT("data/grid/BUILDING_ID", JSON.stringify(payload), false)

console.log("from: " + from_grid + ", to: " + to_grid);